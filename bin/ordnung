#!/usr/bin/env ruby

require "trollop"
require File.join(File.expand_path("..", File.dirname(__FILE__)),"lib","ordnung")

opts = Trollop::options do
  # keep 'short' options in sorted order
  opt :import, "Import files or directories",                              :short => 'i'
  opt :server, "Start Ordnung webinterface",                               :short => 's'
end

abort("try ordnung -h") if opts.all?{|k,v| v.is_a?(FalseClass)}

debug = opts[:debug]

database_init debug

if opts[:server_given]
  if Ordnung::Config.database.nil?
    abort("Configure a database, there is nothing to be shown")
  else
    begin
      `#{File.join(File.expand_path("..", File.dirname(__FILE__)),"bin","app")} #{debug}`
    rescue Interrupt
      sleep 2
      exit
    end
  end
end

opts.each_pair do |key,val|
  case key
  when :import
    if val
      puts "Importing"
    end
  else
    STDERR.puts "Nothing to do"
  end
end
